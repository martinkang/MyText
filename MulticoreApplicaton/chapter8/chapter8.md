#8 동기화 장치와 데이터 공유의 직접 구현

- 일반적으로 운영체제에서 지원하는 동기화 장치와 데이터 공유 API 가 속도도 빠르고 오류도 없으며 기능도 다양.
- 드물지만 조금이라도 효율을 더 높이기 위해 동작 방식이 조금 다른 동기화 장치 
또는 데이터 공유 기능이 필요할 때가 있다.

## 8.1 아토믹 작업
* Atomic 작업 
: 어떤 메모리 작업이 중간 상태나 오류 없이 어느 스레드에서 어떤 시점에 바라보든
성공 또는 실패 둘 중에 하나로만 보여지는 작업
	- 대부분의 경우 메모리 읽기, 쓰기 작업은 아토믹 하다.
	- 하지만 그 이상의 작업은 아토믹 하지 않다.
		- 특정 메모리 값을 증가시키는 명령어의 경우 load-increment-store 순으로 이루어지는데,
		멀티 스레드 환경에서는 이 중간에 다른 스레드가 끼여들어 메모리 값을 바꿔놓을 수 있으므로
		load 단계에서 읽어온 값이 유효하지 않을 수 있다.


### listing 8-1 x64 어셈블리 언어를 이용한 아토믹한 변수 증가
```c++
int atomic_add_int( volatile int* address, int value )
{
	asm volatile( "lock xadd %0, %1": :
			"+m"(*address):
			"memory" );
	return ( *address );
}
```
* asm 키워드
: gcc 가 지원하는 인라인 어셈블리 언어로, 후속되는 구문이 인라이닝 되는 어셈블리 코드임을 알려줌
