# POSIX 스레드의 이용

## POSIX 란?
	* POSIX( Portable Operating System Interface ) 
		1. 유닉스 운영체제에 기반을 두고 있는 일련의 표준 운영체제 인터페이스이다.
		2. UNIX 애플리케이션의 호환성을 위해 제정되었다.
		3. 표준화에 관한 필요성은, 컴퓨터를 사용하고 있는 기업들이 다시 코딩하지 않고서도 다른 컴퓨터 회사가 만든 컴퓨터 시스템에도 운영할 수 있도록, 호환성이 있는 프로그램의 개발을 원하는 데에서 기인했다
		4. 마이크로소프트 윈도는 POSIX 표준을 직접적으로 지원하고 있지는 않지만, 위도 환경에서 POSIX 표준을 이용할 수 있도록 중간 레이어를 제공하는 솔루션을 활용할 수 있다.

		* 이 장에서는 POSIX 표준 인터페이스를 이용하여 멀티스레드 프로그램을 개발하는 방법을 다룬다.


1. 스레드
	1. 스레드드의 생성
		* pthread_create ( pthread_t  *  thread, pthread_attr_t * attr, void * (*start_routine)(void *), void * arg )
	pthread_t 구조체 포인터
	스레드에 접근할 수 있는 핸들이 이 구조체에 저장된다.
	pthread_attr_t 구조체 포인터
	스레드 속성 포인터. NULL 을 넘기면 디폴트
	스레드로 실행될 함수 포인터
	새 스레드가 구동될 때 시작 함수 포인터
	리턴 값
	성공 : 0
	실패 : 에러 종류에 따른 0 이 아닌 값

	스레드의 종료
	스레드를 생성할 때 등록했던 함수가 리턴을 하면 스레드 종료.
	묵시적으로 pthread_exit( ) 호출
	pthread_exit( void* var ), 부모 스레드가 받을 리턴 데이터를 var 에 저장 가능
	스레드 함수가 리턴할 때 묵시적으로 pthread_exit 호출
	명시적으로 스레드가 분리 ( detach ) 되지 않았다면 스레드가 종료되더라도 스레드에서 이용한 리소스는 해제되지 않고 남아 있게 된다.
	이 리소스는 종료된 스레드의 핸들을 파라미터로 pthread_join()을 호출할 때까지 유지

	자식 스레드와의 데이터 교환
	pthread_create 의 인자로 교환 ( void *arg )
	포인터로 자식 스레드에 데이터를 전달하는 것은 가능하면 피하는 것이 좋다.
	어느 시점에 어떤 값을 읽어갈지 명확하지 않으므로 메모리 영역이 스레드가 구동되는 동안 유효하다는 보증이 안 된다.
	pthread_join( pthread_t th, void **thread_return )
	자식 스레드를 기다림. 자식 스레드가 종료되어야만 리턴
	만약 thread_return값이 NULL 이 아니라면, th의 리턴값이 저장된 영역이 전달되게 된다.
	pthread_detach() 함수를 통해서 detached 상태가 되었거나 혹은 pthread_create()로 실행될때 PTHREAD_CREATE_DETACHED 특성으로 실행되었다면 join 으로 기다릴수 없게 된다.
	반환값
	성공할경우 쓰레드식별자인 thread에 쓰레드 식별번호를 저장하고, 0을 리턴한다. 실패했을경우 0 이 아닌 에러코드 값을 리턴한다
	 pthread_detach( pthread_t th )
	실행중인 쓰레드를 detached(분리)상태로 만든다
	식별자th를 가지는 쓰레드를 메인쓰레드에서 분리 시킨다.
	이것은 th를 가지는 쓰레드가 종료되는 즉시 쓰레드의 모든 자원을 되돌려(free)줄 것을 보증한다.
	detach상태가 아닐경우 쓰레드가 종료한다고 하더라도 pthread_join()을 호출하지 않는 한 자원을 되돌려주지 않는다. 

	pthread 의 속성 설정 ( pthread_attr_t )
	detach 여부를 제외한 스레드 속성은 한번 생성되고 나면 바꿀 수가 없다.
	각 속성별로 존재하는 속성 설정 전용 API 를 이용해야 한다.
	스택 크기 속성
	pthread_attr_getstacksize( pthread_attr_t *attributes, int *size )

	여러 개의 스레드가 각기 스택을 가지려면 메인 스레드의 초기 스택 크기를 제한해야만 하고 자식 스레드의 스택 크기도 제한받는다.

	스레드 간의 데이터 공유
	 
	 
	멀티 스레드를 이용하면 모든 스레드가 같은 주소 공간을 보이므로 데이터 공유가 자동적으로 된다.
	적절한 관리 메커니즘 없이 스레드가 공유 데이터를 이용하면 데이터 레이스를 발생시킨다.
	이를 방지하기 위해 POSIX 표준에서는 다양한 동기화 장치와 데이터 공유 방법을 지원한다.
	뮤텍스 락을 이용한 접근 제어
	 
