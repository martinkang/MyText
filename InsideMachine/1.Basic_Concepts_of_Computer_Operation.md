# 1. 컴퓨터 동작의 기본 개념
- 컴퓨터가 하는 일을 간단하게 표현하면 컴퓨터 동작의 기본 개념을 쉽게 이해할 수 있다.                                                                                   


## 계산기 모델
- 컴퓨터가 하는 일을 가장 간략하게 단순화 시켜서 명령어(코드) 스트림과 데이터 스트림을 받아 일련의 결과 스트림을 내보내는 기기로 표현.
  - 코드 스트림(code stream)   : 여러 연산을 순차적으로 나열한 것  
  - 데이터 스트림(data stream) : 코드 스트림의 연산을 적용할 데이터(피연산자)
  - 결과 스트림(result stream) : 코드 스트림을 데이터 스트림에 적용한 연산 결과.  
![1-1]( https://github.com/martinkang/Study/blob/master/InsideMachine/img/1-1.png )



- 아래 그림의 수식을 예를들면 덧셈 연산자(+)를 코드스트림이 2개의 정수를 데이터 스트림, 이 연산의 결과를 결과 스트림에 해당한다     
![1-2]( https://github.com/martinkang/Study/blob/master/InsideMachine/img/1-2.png )

- 이와같이 컴퓨터를 작은 계산기로 마찬가지로 숫자와 연산자를 입력으로 받아들이고, 연산을 수행한 후 그 결과를 표시하는 기기로 표현 할 수 있다.
  - 이 결과는 컴퓨터 게임에서의 렌더링된 화면 필셀이 될 수 있고, 스프레드쉬트의 데이터가 될 수도 있다.


## 문서 관리원
- 컴퓨터를 단순 연산만 하는 기기가 아닌 일련의 데이터를 읽고(read) 수정한 후 (modify), 수정한 데이터를 쓰는(wirte) 기기로 표현한다.

- 스토어 프로그램 컴퓨터
  - 컴퓨터가 읽기-수정-쓰기를 수행하기 위해서는 다음 3가지 기본 요소가 필요하다.
    - 저장소
      - 컴퓨터가 데이터를 '읽고','쓴다' 고 할때 이 데이터를 저장하는 저장소.
    - 산술 연산 장치(ALU : Artimetic Logic Unit)
      - 저장소에서 읽어온 데이터에 대해 산술 연산을 수행하는 장치.
    - 버스
      - ALU 와 저장소 사이에서 데이터를 전송하는 통로.
  - 컴퓨터란 필요한 데이터를 얻어서 지정된 연산을 수행한 후, 지정된 곳에 연산 결과를 저장하는 3가지 단계 작업이 미리 정해진 일정 조건이 만족할때까지 반복하는 기기로 표현할 수 있다    
![1-3]( https://github.com/martinkang/Study/blob/master/InsideMachine/img/1-3.png )


## 레지스터 파일
- 연산을 빠르게 수행하기 위해 빠르게 접근할 수 있는 데이터 저장소를 레지스터라 한다.
  - 실제 연산은 ALU 에서 일어나기 때문에 이 저장소의 위치는 ALU 에서 가까운게 좋다.
  - 여러 레지스터가 모여 레지스터 파일을 이룬다.
- CPU 면적과 같은 현실적 제약 사항을 고려할 때 ALU 근처의 저장소 공간은 그리 커질 수 없다.
  - 저장소 공간의 크기가 매우 적어 실제 코드 스트림의 일부밖에 저장할 수 없다.


- 레지스터가 포함된 ALU 3 단계 작업
  1. 덧셈을 할 2 개의 데이터를 지정된 2개의 소스 레지스터로 읽어온다.
  2. ALU 를 이용해 두 수를 더한다.
  3. 연산 결과를 목적 레지스터에 넣는다.

## RAM
- 레지스터 만으로는 매우 많은 양의 데이터를 보관할 수 없기 때문에, 이를 저장할 저장소로 메인메모리 (RAM : Random Access Memory) 가 그 역할을 한다.  
- ALU 연산을 위해서는 메인 메모리의 데이터 중 일부가 레지스터로 옮겨져 사용된다.
- 아래 그림과 같이 메인 메모리는 레지스터에 비해 ALU 에서 훨씬 멀리 떨어져 있으며, 실제로 ALU 와 레지스터는 마이크로프로세서 내부에 있지만 메인 메모리는 별로로 존재하며, 메모리 버스를 통해 프로세서와 연결된다.
  - 거리가 먼 만큼 메인 메모리의 데이터를 버스를 통해 프로세서로 전송하려면 상당한 시간이 필요하다.
  - 레지스터를 통해 메인 메모리의 데이터를 ALU 근처에 저장할 수 있으므로, 컴퓨터 연산 속도는 메인 메모리의 속도에 의해 제한 되지 않는다   
![1-4]( https://github.com/martinkang/Study/blob/master/InsideMachine/img/1-4.png )


- RAM(메인 메모리)이 포함된 ALU 3 단계 작업
  1. 메인 메모리에서 2 개의 데이터를 읽어서 소스 레지스터에 넣는다.
  2. ALU 를 이용해 두 레지스터의 값을 더한다.
  3. 연산 결과를 목적 레지스터에 넣는다.
  4. 목적 레지스터에 저장된 덧셈 결과를 메인 메모리로 전송한다.


## 코드 스트림
- 코드 스트림은 연산의 나열로, 단순 덧셈과 뺄샘 같은 간단한 산술 연산만이 아닌, 여러 명령어(instruction) 의 순차적 나열로 정의할 수 있다.
    - 이를 프로그램 이라 한다.
- 명령어는 컴퓨터(ALU 뿐만 아닌 컴퓨터 내부의 모든 유닛)가 어떤 일을 수행할지 지정하는 역할도 한다.
### 명령어의 종류
  - 산술 명령어
    - ALU 의 특정 산술 연산을 담당
      - add, sub, mul, div 등
  - 메모리 접근 명령어
    - 프로세서와 메인 메모리 사이의 데이터 전송을 담당
      - load, store 등

#### 간단한 프로그램의 예.
- 산술 명령어 포맷
  - 명령어 소스1, 소스2, 목적
  ```c++
  add A, B, C // 레지스터 A 와 B 의 값을 더해 C 에 덮어쓴다.
  ```
- 메모리 명령어 포맷
  - 명령어 소스, 목적
  ```c++
  load #12, A // 메모리셀 #12 의 내용을 레지스터 A 에 읽어온다.
  ```

- 프로그램 예
```c++
load #12, A  // 메모리셀 #12 의 내용을 레지스터 A 에 읽어온다.
load #13, B  // 메모리셀 #13 의 내용을 레지스터 B 에 읽어온다.
add A, B, C  // 레지스터 A 와 B 의 값을 더해 레지스터 C 에 쓴다.
store C, #14 // 덧셈 결과를 레지스터 C 에서 읽어 메모리셀 #14에 쓴다.
```
![1-5]( https://github.com/martinkang/Study/blob/master/InsideMachine/img/1-5.png )


## 메모리 접근
- 위의 예에서는 프로그래머가 메모리의 어느 위치에 어떤 데이터가 있는지 모두 알아야만 했다.
  - 즉 프로그래머는 모든 메모리 셀의 용도를 미리 정해야만 했다.
  - 실제 프로그램에서는 훨씬 많은 메모리 셀이 존재하므로, 정확한 메모리 지정이 필요없는 유연한 메모리 접근 방식이 필수적이다.
- 레지스터값을 메모리 주소로 사용할 수 있게 하면 더 유연한 메모리 접근이 가능하다.


### 직접값
- 레지스터 대신 직접 사용하는 값을 직접값이라고 한다.
  - A 에 있는 값을 2 증가시키기 위해, 2가 저장된 메모리 셀에서 데이터를 레지스터 B 에 읽어온 후 덧셈을 하는 대신 A 에 2 를 직접 더할 수 있다.
```c++
add A, 2, A // 레지스터 A 의 값에 2 를 더해 기존 A 의 값을 덮어쓴다.
```


### 상대 레지스터 주소 지정
- 기본 주소(base address)를 저장하고 있는 레지스터와 기본 주소에서의 거리를 통해 접근할 메모리 주소로 표현.
  - 절대 주소 지정 대신 상대 레지스터 주소 지정을 사용할 경우, 메모리상에서 데이터의 위치를 정확히 모르는 상태에서도 프로그램을 짤 수 있다.
  - 프로그래머가 운영체제에서 데이터 세그먼트의 기본 주소를 저장하는 곳만 알고 있다면, 상대 주소를 이용하여 모든 메모리 접근을 지정할 수 있다.
    - 세그먼트의 기본 주소는 운영체제가 프로그램을 메모리에 로드할 때 정해지고 미리 알 수 없으므로, 절대 주소 지정방식을 사용할 경우 프로그램 로드시마다 모든 주소값이 변경되어, 주소계산하는 방식이 매우 복잡해지고 오래 걸릴 수 있다.
-
